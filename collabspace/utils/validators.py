"""
Утилиты для валидации контента
"""
import re


# Список запрещенных слов (можно расширить)
FORBIDDEN_WORDS = [
    'хуй', 'хуйня', 'хуев', 'хуя', 'хуе',
    'жопа', 'жоп', 'жопы', 'жопой',
    'какашка', 'какашки', 'какашк',
    'бля', 'блядь', 'бляд', 'бляди',
    'ебан', 'ебать', 'ебал', 'ебат',
    'пизд', 'пизда', 'пиздец',
    'сука', 'суки', 'сук',
    'мудак', 'мудаки', 'мудач',
    'гандон', 'гондон',
    'долбоеб', 'долбоёб',
    'залупа', 'залуп',
    'еблан', 'ебланы',
    'пидор', 'пидорас', 'пидоры',
    'гомик', 'гомосек',
    'шлюха', 'шлюхи',
    'проститутка', 'проститутк',
    'уебан', 'уебаны',
    'ебанутый', 'ебанутая',
    'ебануть', 'ебанулся',
    'ебанько', 'ебаньки',
    'ебло', 'ебла',
    'ебля', 'ебле',
    'ебнутый', 'ебнутая',
    'ебнуться', 'ебнулся',
    'пися', 'сися',
    'попа', 'попка',
]


def contains_forbidden_words(text):
    """
    Проверяет, содержит ли текст запрещенные слова.
    Возвращает список найденных запрещенных слов или пустой список.
    """
    if not text:
        return []
    
    text_lower = text.lower()
    # Удаляем знаки препинания для более точной проверки
    text_clean = re.sub(r'[^\w\s]', ' ', text_lower)
    # Заменяем множественные пробелы на один
    text_clean = re.sub(r'\s+', ' ', text_clean).strip()
    
    found_words = []
    for forbidden in FORBIDDEN_WORDS:
        # Используем границы слов для точного совпадения
        # Проверяем как целое слово, так и в составе других слов
        pattern = r'\b' + re.escape(forbidden) + r'\b'
        if re.search(pattern, text_clean):
            found_words.append(forbidden)
        # Также проверяем, если запрещенное слово является частью другого слова
        elif forbidden in text_clean:
            found_words.append(forbidden)
    
    return list(set(found_words))  # Убираем дубликаты


def validate_content(text, field_name='Текст'):
    """
    Валидирует контент на наличие запрещенных слов.
    Вызывает ValidationError, если найдены запрещенные слова.
    """
    from django.core.exceptions import ValidationError
    
    if not text:
        return text
    
    forbidden = contains_forbidden_words(text)
    if forbidden:
        raise ValidationError(
            f'{field_name} содержит недопустимые слова. Пожалуйста, используйте корректную лексику.'
        )
    
    return text
